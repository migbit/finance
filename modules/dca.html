<!DOCTYPE html>
<html lang="pt-PT">
<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>DCA</title>
  <link rel="stylesheet" href="../css/styles.pcolor.css">
  <link rel="stylesheet" href="../css/mobile.css">
  <link rel="icon" href="../favicon.ico" type="image/x-icon" />
  <link rel="manifest" href="../manifest.json">
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.3/dist/chart.umd.min.js"></script>
</head>

<body data-page="dca">
  <!-- Hamburger icon (always visible on mobile) -->
  <button id="menu-icon" aria-label="Open menu">‚ò∞</button>
  
  <!-- Header / Nav -->
  <header>
    <nav id="nav-menu">
      <ul>
        <!-- Login/User section at top -->
        <li id="login-section" class="login-block">
          <a href="#" id="login-btn" class="login-visible">üîê Login</a>
          <span id="user-info" class="user-visible" style="display:none;">
            <a href="#" id="user-name">üë§ Username</a>
          </span>
        </li>

        <li class="separator"></li>

        <!-- Sec√ß√£o: Apartamentos -->
        <li class="menu-title">Apartamentos</li>
        <li><a href="faturas.html">üìÑ Faturas</a></li>
        <li><a href="analise.html">üìä An√°lise</a></li>
        <li><a href="analise123.html">üè† 123</a></li>
        <li><a href="analise1248.html">üè† 1248</a></li>
        <li><a href="analise123vs1248.html">‚öñÔ∏è 123 vs 1248</a></li>
        <li><a href="caixa.html">üí∞ Caixa</a></li>
        <li><a href="tmt.html">üß≥ Taxa Tur√≠stica</a></li>
        <li><a href="diversos.html">üìã Diversos</a></li>

        <li class="separator"></li>

        <!-- Sec√ß√£o: Investimentos -->
        <li class="menu-title">Investimentos</li>
        <li><a href="dca.html" class="active">üìà DCA</a></li>
        <li><a href="crypto.html">üöÄ Cripto</a></li>
      </ul>
    </nav>
  </header>

  <main class="dca-page">
    <!-- === T√≠tulo === -->
    <h2 class="page-title center">DCA ‚Äì Trade Republic</h2>

    <!-- === Par√¢metros & Juro (collapsible) === -->
    <section class="report-section">
      <div style="text-align: center; margin-bottom: 1rem;">
        <button id="btn-toggle-params" type="button" class="primary">Mostrar Par√¢metros</button>
      </div>
      
      <div id="params-juro-container" style="display: none;">
        <!-- Par√¢metros -->
        <div class="viz-card params-card">
          <h4>Par√¢metros</h4>
          <div class="table-wrap">
            <table class="table-dca params-table" id="params-table">
              <thead>
                <tr>
                  <th class="num">Data final</th>
                  <th class="num">VWCE %</th>
                  <th class="num">AGGH %</th>
                  <th class="num">Contribui√ß√£o Mensal</th>
                  <th style="width:140px">A√ß√µes</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td class="num"><input id="end-date" type="month" /></td>
                  <td class="num"><input id="pct-swda" type="number" min="0" max="100" step="0.01" /></td>
                  <td class="num"><input id="pct-aggh" type="number" min="0" max="100" step="0.01" /></td>
                  <td class="num">
                    <div class="input-euro">
                      <input id="monthly-contribution" type="number" step="1" value="152" />
                    </div>
                  </td>
                  <td style="text-align:right">
                    <button id="btn-save-params" type="button" class="primary">Editar/Gravar</button>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>

        <!-- Juro -->
        <div class="viz-card juro-card">
          <h4>Juro</h4>
          <div class="table-wrap">
            <table class="table-dca" id="juro-table">
              <thead>
                <tr>
                  <th class="num">Saldo</th>
                  <th class="num">Taxa de juro</th>
                  <th class="num">Valor mensal</th>
                  <th class="num">Valor ganho em Juros</th>
                  <th style="text-align:center">A√ß√µes</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td class="num">
                    <div class="input-euro">
                      <input id="juro-saldo" type="number" step="0.01" class="cell" placeholder="0,00" inputmode="decimal" />
                    </div>
                  </td>
                  <td class="num">
                    <input id="juro-taxa" type="number" step="0.01" class="cell" value="2.00" disabled />
                  </td>
                  <td class="num"><span id="juro-mensal">0 ‚Ç¨</span></td>
                  <td class="num"><span id="juro-acumulado">0 ‚Ç¨</span></td>
                  <td style="text-align:center">
                    <button id="btn-juro-editar" type="button">Editar</button>
                    <button id="btn-juro-gravar" type="button">Gravar</button>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </section>

    <!-- === KPIs & Cen√°rios === -->
    <section class="report-section">
      <div class="viz-card" id="kpi-cenarios-card">
        <h4 style="margin-bottom: 1rem;">KPIs & Cen√°rios</h4>
        
        <!-- Current Performance KPIs -->
        <div class="kpi-grid enhanced">
          <div class="kpi-item enhanced">
            <div class="kpi-label">Total Investido</div>
            <div class="kpi-value" id="kpi-total-invested">-</div>
          </div>
          <div class="kpi-item enhanced">
            <div class="kpi-label">Valor Atual</div>
            <div class="kpi-value" id="kpi-current-value">-</div>
          </div>
          <div class="kpi-item enhanced">
            <div class="kpi-label">Resultado</div>
            <div class="kpi-value" id="kpi-result">-</div>
            <div class="kpi-sub" id="kpi-result-pct">-</div>
          </div>
          <div class="kpi-item enhanced">
            <div class="kpi-label">Juros Acum.</div>
            <div class="kpi-value" id="kpi-total-interest">-</div>
          </div>
        </div>

        <!-- Investment Progress Bar -->
        <div class="progress-section" style="margin-top: 1.5rem;">
          <div class="progress-header" style="display: flex; justify-content: space-between; margin-bottom: 0.5rem;">
            <span style="font-weight: 600; color: var(--text-dim);">Progresso do Investimento</span>
            <span style="font-weight: 700; color: var(--p2);" id="progress-percentage">0%</span>
          </div>
          <div class="progress-bar-container" style="height: 32px; background: #e5e7eb; border-radius: 16px; overflow: hidden; position: relative;">
            <div class="progress-bar-fill" id="progress-bar-fill" style="height: 100%; background: linear-gradient(90deg, #1a8f5d 0%, #16a34a 100%); width: 0%; transition: width 0.6s ease; display: flex; align-items: center; justify-content: flex-end; padding-right: 12px;">
              <span style="color: white; font-weight: 700; font-size: 0.85rem;" id="progress-bar-text"></span>
            </div>
          </div>
          <div class="progress-footer" style="display: flex; justify-content: space-between; margin-top: 0.5rem; font-size: 0.85rem; color: var(--text-dim);">
            <span id="progress-invested">0 ‚Ç¨</span>
            <span id="progress-target">0 ‚Ç¨</span>
          </div>
        </div>

        <!-- Goal Tracking Indicator -->
        <div class="goal-tracking" style="margin-top: 1.5rem; padding: 1rem; background: #f9fafb; border-radius: 12px; text-align: center;">
          <div class="goal-status" id="goal-status">
            <span class="goal-icon" style="font-size: 2rem;">‚è≥</span>
            <div class="goal-text" style="margin-top: 0.5rem; font-weight: 600; color: var(--text-dim);" id="goal-text">A calcular...</div>
          </div>
        </div>

        <!-- Scenario Comparison -->
        <div class="scenario-comparison" style="margin-top: 1.5rem;">
          <h5 style="text-align: center; margin-bottom: 1rem; color: var(--text-dim);">Cen√°rios de Crescimento (pr√≥ximo m√™s)</h5>
          <div class="scenario-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
            <div class="scenario-card" data-scenario="conservative">
              <div class="scenario-header" style="background: #e8f5e8; padding: 0.75rem; border-radius: 8px 8px 0 0;">
                <div class="scenario-title" style="font-weight: 700; color: #2e7d32;">Conservador</div>
                <div class="scenario-rate" style="font-size: 0.9rem; color: #2e7d32;">+3% mensal</div>
              </div>
              <div class="scenario-body" style="padding: 0.75rem; background: white; border-radius: 0 0 8px 8px;">
                <div class="scenario-value" id="scenario-conservative">-</div>
                <div class="scenario-diff" style="font-size: 0.85rem; margin-top: 0.25rem; font-weight: 600;" id="scenario-conservative-diff">-</div>
              </div>
            </div>
            <div class="scenario-card" data-scenario="moderate">
              <div class="scenario-header" style="background: #e3f2fd; padding: 0.75rem; border-radius: 8px 8px 0 0;">
                <div class="scenario-title" style="font-weight: 700; color: #1565c0;">Moderado</div>
                <div class="scenario-rate" style="font-size: 0.9rem; color: #1565c0;">+5% mensal</div>
              </div>
              <div class="scenario-body" style="padding: 0.75rem; background: white; border-radius: 0 0 8px 8px;">
                <div class="scenario-value" id="scenario-moderate">-</div>
                <div class="scenario-diff" style="font-size: 0.85rem; margin-top: 0.25rem; font-weight: 600;" id="scenario-moderate-diff">-</div>
              </div>
            </div>
            <div class="scenario-card" data-scenario="optimistic">
              <div class="scenario-header" style="background: #fff3e0; padding: 0.75rem; border-radius: 8px 8px 0 0;">
                <div class="scenario-title" style="font-weight: 700; color: #ef6c00;">Otimista</div>
                <div class="scenario-rate" style="font-size: 0.9rem; color: #ef6c00;">+7% mensal</div>
              </div>
              <div class="scenario-body" style="padding: 0.75rem; background: white; border-radius: 0 0 8px 8px;">
                <div class="scenario-value" id="scenario-optimistic">-</div>
                <div class="scenario-diff" style="font-size: 0.85rem; margin-top: 0.25rem; font-weight: 600;" id="scenario-optimistic-diff">-</div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- === Juro === -->
    <section class="report-section">
      <div class="viz-card juro-card">
        <h4>Juro</h4>
        <div class="table-wrap">
          <table class="table-dca" id="juro-table">
            <thead>
              <tr>
                <th class="num">Saldo</th>
                <th class="num">Taxa de juro</th>
                <th class="num">Valor mensal</th>
                <th class="num">Valor ganho em Juros</th>
                <th style="text-align:center">A√ß√µes</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td class="num">
                  <div class="input-euro">
                    <input id="juro-saldo" type="number" step="0.01" class="cell" placeholder="0,00" inputmode="decimal" />
                  </div>
                </td>
                <td class="num">
                  <input id="juro-taxa" type="number" step="0.01" class="cell" value="2.00" disabled />
                </td>
                <td class="num"><span id="juro-mensal">0 ‚Ç¨</span></td>
                <td class="num"><span id="juro-acumulado">0 ‚Ç¨</span></td>
                <td style="text-align:center">
                  <button id="btn-juro-editar" type="button">Editar</button>
                  <button id="btn-juro-gravar" type="button">Gravar</button>
                </td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </section>

    <!-- === Registo Mensal === -->
    <section class="report-section">
      <div class="viz-card">
        <h4>Registo Mensal</h4>
        <div class="table-wrap" id="dca-table-wrap"><!-- tabela via JS --></div>
        <div class="center" style="margin-top: 1rem;">
          <button id="toggle-others" type="button">Expandir anos</button>
        </div>
      </div>
    </section>

  </main>

  <script type="module" src="../js/dca-main.js"></script>
</body>
</html>